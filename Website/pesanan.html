<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pesanan & Keranjang - Makanan Wong Solo">
    <meta name="keywords" content="keranjang belanja, checkout, pesanan makanan, makanan solo">
    <meta name="author" content="ALWANU ZAKY RAIHAN">
    
    <title>Pesanan - Makanan Wong Solo</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/icons/favicon.ico">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Utama -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/order.css">
</head>
<body>
    <!-- Batik Background Pattern -->
    <div class="batik-pattern"></div>
    
    <!-- Skip to Content -->
    <a href="#main-content" class="skip-to-content">Skip to Content</a>
    
    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner">
        <div class="spinner"></div>
    </div>
    
    <!-- WhatsApp Bubble -->
    <div class="wa-bubble">
        <a href="https://api.whatsapp.com/send/?phone=6289513439235&text=Halo%2C+saya+ingin+bertanya+tentang%3A+...&type=phone_number&app_absent=0" 
           target="_blank" 
           class="wa-link"
           aria-label="Hubungi via WhatsApp">
            <div class="wa-icon">
                <i class="fab fa-whatsapp"></i>
            </div>
            <div class="wa-tooltip">
                Tanya via WhatsApp
            </div>
        </a>
    </div>
    
    <!-- Header -->
    <header class="navbar-container">
        <div class="navbar-wrapper">
            <!-- Logo -->
            <div class="logo-section">
                <a href="index.html" class="logo-link">
                    <div class="logo-icon">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="logo-text">
                        <span class="logo-title">Makanan</span>
                        <span class="logo-subtitle">Wong Solo</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Menu -->
            <div class="nav-menu">
                <a href="index.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </a>
                <a href="produk.html" class="nav-link">
                    <i class="fas fa-utensils"></i>
                    <span>Produk</span>
                </a>
                <a href="pesanan.html" class="nav-link active">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pesanan</span>
                </a>
                <a href="maosan.html" class="nav-link">
                    <i class="fas fa-newspaper"></i>
                    <span>Maosan</span>
                </a>
                <a href="testimoni.html" class="nav-link">
                    <i class="fas fa-star"></i>
                    <span>Testimoni</span>
                </a>
                <a href="contact.html" class="nav-link">
                    <i class="fas fa-address-book"></i>
                    <span>Contact</span>
                </a>
            </div>

            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Cart Counter -->
            <div class="cart-counter" id="cartCounter">
                <a href="pesanan.html">
                    <i class="fas fa-shopping-bag"></i>
                    <span class="cart-count">0</span>
                </a>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <div class="mobile-logo">
                    <i class="fas fa-utensils"></i>
                    <span>Makanan Wong Solo</span>
                </div>
                <button class="mobile-menu-close" id="mobileMenuClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mobile-nav-links">
                <a href="index.html" class="mobile-nav-link">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </a>
                <a href="produk.html" class="mobile-nav-link">
                    <i class="fas fa-utensils"></i>
                    <span>Produk</span>
                </a>
                <a href="pesanan.html" class="mobile-nav-link active">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Pesanan</span>
                </a>
                <a href="maosan.html" class="mobile-nav-link">
                    <i class="fas fa-newspaper"></i>
                    <span>Maosan</span>
                </a>
                <a href="testimoni.html" class="mobile-nav-link">
                    <i class="fas fa-star"></i>
                    <span>Testimoni</span>
                </a>
                <a href="contact.html" class="mobile-nav-link">
                    <i class="fas fa-address-book"></i>
                    <span>Contact</span>
                </a>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main id="main-content">
        <!-- Order Tabs -->
        <section class="order-tabs-section section-padding">
            <div class="container">
                <div class="order-header">
                    <h1 class="order-title">
                        <span class="text-primary">Pesanan</span>
                        <span class="text-dark">Saya</span>
                    </h1>
                    <p class="order-subtitle">Kelola pesanan dan keranjang belanja Anda</p>
                </div>
                
                <!-- Tabs Navigation -->
                <div class="order-tabs">
                    <button class="order-tab active" data-tab="keranjang">
                        <i class="fas fa-shopping-cart"></i>
                        Keranjang
                        <span class="tab-badge" id="cartTabCount">0</span>
                    </button>
                    <button class="order-tab" data-tab="pesanan-saya">
                        <i class="fas fa-clipboard-list"></i>
                        Pesanan Saya
                        <span class="tab-badge" id="ordersTabCount">0</span>
                    </button>
                </div>
                
                <!-- Tabs Content -->
                <div class="tabs-content">
                    <!-- Keranjang Tab -->
                    <div class="tab-pane active" id="keranjang-tab">
                        <div class="cart-container">
                            <!-- Cart Items -->
                            <div class="cart-items" id="cartItems">
                                <!-- Cart items will be loaded here -->
                            </div>
                            
                            <!-- Empty Cart State -->
                            <div class="empty-state" id="emptyCartState">
                                <div class="empty-icon">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                                <h3>Keranjang Kosong</h3>
                                <p>Belum ada item dalam keranjang Anda. Yuk, pesan makanan favorit Anda!</p>
                                <a href="produk.html" class="btn btn-primary">
                                    <i class="fas fa-utensils"></i>
                                    Lihat Menu
                                </a>
                            </div>
                            
                            <!-- Cart Summary -->
                            <div class="cart-summary" id="cartSummary">
                                <div class="summary-header">
                                    <h3>Ringkasan Pesanan</h3>
                                </div>
                                <div class="summary-content">
                                    <div class="summary-row">
                                        <span>Subtotal</span>
                                        <span id="subtotal">Rp 0</span>
                                    </div>
                                    <div class="summary-row">
                                        <span>Biaya Pengiriman</span>
                                        <span id="deliveryFee">Rp 10.000</span>
                                    </div>
                                    <div class="summary-divider"></div>
                                    <div class="summary-row total">
                                        <span>Total</span>
                                        <span id="totalAmount">Rp 10.000</span>
                                    </div>
                                </div>
                                <div class="summary-actions">
                                    <button class="btn btn-outline" id="continueShopping">
                                        <i class="fas fa-arrow-left"></i>
                                        Lanjut Belanja
                                    </button>
                                    <button class="btn btn-primary" id="checkoutBtn">
                                        <i class="fas fa-shopping-bag"></i>
                                        Checkout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pesanan Saya Tab -->
                    <div class="tab-pane" id="pesanan-saya-tab">
                        <div class="orders-container">
                            <!-- Orders List -->
                            <div class="orders-list" id="ordersList">
                                <!-- Orders will be loaded here -->
                            </div>
                            
                            <!-- Empty Orders State -->
                            <div class="empty-state" id="emptyOrdersState">
                                <div class="empty-icon">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <h3>Belum Ada Pesanan</h3>
                                <p>Anda belum membuat pesanan apapun. Mulai dengan memesan makanan favorit Anda!</p>
                                <a href="produk.html" class="btn btn-primary">
                                    <i class="fas fa-utensils"></i>
                                    Lihat Menu
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Footer -->
    <footer class="footer-section bg-dark">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-info">
                    <div class="footer-logo">
                        <div class="logo-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="logo-text">
                            <span class="logo-title">Makanan</span>
                            <span class="logo-subtitle">Wong Solo</span>
                        </div>
                    </div>
                    <p class="footer-description">
                        Melestarikan cita rasa autentik makanan tradisional Surakarta sejak 1995. 
                        Warisan kuliner keluarga Keraton Surakarta.
                    </p>
                    <div class="footer-social">
                        <a href="https://api.whatsapp.com/send/?phone=6289513439235&text=Halo%2C+saya+ingin+bertanya+tentang%3A+...&type=phone_number&app_absent=0" 
                           target="_blank" class="social-link">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="https://instagram.com/makananwongsolo" target="_blank" class="social-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="mailto:makananwongsolo@gmail.com" class="social-link">
                            <i class="fas fa-envelope"></i>
                        </a>
                    </div>
                </div>

                <div class="footer-contact">
                    <h3 class="footer-title">Kontak Kami</h3>
                    <ul class="contact-list">
                        <li>
                            <i class="fas fa-phone"></i>
                            <span>WhatsApp: +62 895-1343-9235</span>
                        </li>
                        <li>
                            <i class="fab fa-instagram"></i>
                            <span>Instagram: @makananwongsolo</span>
                        </li>
                        <li>
                            <i class="fas fa-envelope"></i>
                            <span>Email: makananwongsolo@gmail.com</span>
                        </li>
                    </ul>
                </div>

                <div class="footer-address">
                    <h3 class="footer-title">Alamat</h3>
                    <div class="address-content">
                        <i class="fas fa-map-marker-alt"></i>
                        <p>Jl. Yos Sudarso, Gawanan,<br>
                           Kec. Colomadu,<br>
                           Kab. Karanganyar,<br>
                           Jawa Tengah 57175</p>
                    </div>
                </div>

                <div class="footer-hours">
                    <h3 class="footer-title">Jam Buka</h3>
                    <ul class="hours-list">
                        <li>
                            <span>Senin - Kamis</span>
                            <span>08:00 - 16:00 WIB</span>
                        </li>
                        <li>
                            <span>Jum'at - Minggu/Hari Libur</span>
                            <span>10:00 - 16:00 WIB</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                <div class="copyright">
                    &copy; 2025 Makanan Wong Solo. All rights reserved.
                </div>
                <div class="footer-links">
                    <a href="index.html">Beranda</a>
                    <a href="produk.html">Produk</a>
                    <a href="pesanan.html">Pesanan</a>
                    <a href="maosan.html">Maosan</a>
                    <a href="testimoni.html">Testimoni</a>
                    <a href="contact.html">Contact</a>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Checkout Modal -->
    <div class="checkout-modal" id="checkoutModal">
        <div class="modal-overlay" id="checkoutOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Checkout Pesanan</h2>
                <button class="modal-close" id="checkoutClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="checkout-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Informasi Pesanan</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Konfirmasi</div>
                    </div>
                </div>
                
                <!-- Step 1: Order Info -->
                <div class="checkout-step active" id="step1">
                    <form id="orderForm">
                        <div class="form-group">
                            <label for="customerName">
                                <i class="fas fa-user"></i>
                                Nama Lengkap
                            </label>
                            <input type="text" id="customerName" required placeholder="Masukkan nama lengkap Anda">
                        </div>
                        
                        <div class="form-group">
                            <label for="customerPhone">
                                <i class="fas fa-phone"></i>
                                Nomor WhatsApp
                            </label>
                            <input type="tel" id="customerPhone" required placeholder="Contoh: 081234567890">
                        </div>
                        
                        <div class="form-group">
                            <label for="customerAddress">
                                <i class="fas fa-map-marker-alt"></i>
                                Alamat Pengiriman (Opsional)
                            </label>
                            <textarea id="customerAddress" rows="3" placeholder="Masukkan alamat lengkap untuk pengiriman"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="orderNotes">
                                <i class="fas fa-edit"></i>
                                Catatan Pesanan (Opsional)
                            </label>
                            <textarea id="orderNotes" rows="3" placeholder="Contoh: Tidak pakai pedas, tambah sambal, dll."></textarea>
                        </div>
                        
                        <div class="order-summary-preview">
                            <h4>Ringkasan Pesanan</h4>
                            <div id="checkoutItems"></div>
                            <div class="preview-total">
                                <span>Total</span>
                                <span id="checkoutTotal">Rp 0</span>
                            </div>
                        </div>
                    </form>
                </div>
                
                <!-- Step 2: Confirmation -->
                <div class="checkout-step" id="step2">
                    <div class="confirmation-content">
                        <div class="confirmation-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Konfirmasi Pesanan</h3>
                        <p>Pastikan informasi pesanan Anda sudah benar sebelum melanjutkan ke WhatsApp.</p>
                        
                        <div class="confirmation-details">
                            <h4>Detail Pesanan</h4>
                            <div class="detail-item">
                                <span>Nomor Pesanan:</span>
                                <strong id="confirmationOrderId">#ORD-0001</strong>
                            </div>
                            <div class="detail-item">
                                <span>Nama:</span>
                                <span id="confirmationName">-</span>
                            </div>
                            <div class="detail-item">
                                <span>WhatsApp:</span>
                                <span id="confirmationPhone">-</span>
                            </div>
                            <div class="detail-item">
                                <span>Total:</span>
                                <strong id="confirmationTotal">Rp 0</strong>
                            </div>
                        </div>
                        
                        <div class="confirmation-warning">
                            <i class="fas fa-info-circle"></i>
                            <p>Setelah konfirmasi, Anda akan diarahkan ke WhatsApp untuk menyelesaikan pembayaran.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Actions -->
                <div class="modal-actions">
                    <button class="btn btn-outline" id="prevStepBtn" style="display: none;">
                        <i class="fas fa-arrow-left"></i>
                        Kembali
                    </button>
                    <button class="btn btn-primary" id="nextStepBtn">
                        Selanjutnya
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <a href="#" class="btn btn-success" id="confirmWhatsAppBtn" target="_blank" style="display: none;">
                        <i class="fab fa-whatsapp"></i>
                        Konfirmasi via WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript Files -->
    <script src="assets/js/include.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/order.js"></script>
    
    <!-- Inline script untuk pesanan.html -->
    <script>
        // Order data storage
        let currentStep = 1;
        let orderData = {
            items: [],
            customer: {
                name: '',
                phone: '',
                address: '',
                notes: ''
            },
            orderId: '',
            total: 0,
            date: ''
        };

        // Initialize order page
        document.addEventListener('DOMContentLoaded', function() {
            // Setup tabs
            setupTabs();
            
            // Load cart items
            loadCartItems();
            
            // Load orders history
            loadOrdersHistory();
            
            // Setup checkout modal
            setupCheckoutModal();
            
            // Update cart counter
            updateCartCounter();
            
            // Setup continue shopping button
            const continueBtn = document.getElementById('continueShopping');
            if (continueBtn) {
                continueBtn.addEventListener('click', function() {
                    window.location.href = 'produk.html';
                });
            }
        });

        // Setup tabs
        function setupTabs() {
            const tabs = document.querySelectorAll('.order-tab');
            const tabPanes = document.querySelectorAll('.tab-pane');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    tabPanes.forEach(p => p.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
        }

        // Load cart items
        function loadCartItems() {
            const cartItems = getCart();
            const cartItemsContainer = document.getElementById('cartItems');
            const emptyCartState = document.getElementById('emptyCartState');
            const cartSummary = document.getElementById('cartSummary');
            const cartTabCount = document.getElementById('cartTabCount');
            
            if (cartItems.length === 0) {
                // Show empty state
                if (emptyCartState) emptyCartState.style.display = 'flex';
                if (cartItemsContainer) cartItemsContainer.style.display = 'none';
                if (cartSummary) cartSummary.style.display = 'none';
                if (cartTabCount) cartTabCount.textContent = '0';
                return;
            }
            
            // Hide empty state
            if (emptyCartState) emptyCartState.style.display = 'none';
            if (cartItemsContainer) cartItemsContainer.style.display = 'block';
            if (cartSummary) cartSummary.style.display = 'block';
            if (cartTabCount) cartTabCount.textContent = cartItems.length.toString();
            
            // Calculate total
            let subtotal = 0;
            
            // Render cart items
            if (cartItemsContainer) {
                cartItemsContainer.innerHTML = cartItems.map(item => {
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    
                    return `
                        <div class="cart-item" data-id="${item.id}">
                            <div class="item-image">
                                <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                     alt="${item.name}" loading="lazy">
                            </div>
                            <div class="item-details">
                                <h4 class="item-name">${item.name}</h4>
                                <p class="item-price">Rp ${item.price.toLocaleString('id-ID')}</p>
                            </div>
                            <div class="item-quantity">
                                <button class="quantity-btn minus" data-id="${item.id}">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" class="quantity-input" value="${item.quantity}" min="1" max="99" data-id="${item.id}">
                                <button class="quantity-btn plus" data-id="${item.id}">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <div class="item-total">
                                <span>Rp ${itemTotal.toLocaleString('id-ID')}</span>
                            </div>
                            <button class="item-remove" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                }).join('');
                
                // Add event listeners to cart items
                setupCartItemEvents();
            }
            
            // Update summary
            updateCartSummary(subtotal);
        }

        // Setup cart item events
        function setupCartItemEvents() {
            // Quantity minus buttons
            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    updateCartItemQuantity(itemId, -1);
                });
            });
            
            // Quantity plus buttons
            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    updateCartItemQuantity(itemId, 1);
                });
            });
            
            // Quantity input changes
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', function() {
                    const itemId = this.dataset.id;
                    const quantity = parseInt(this.value) || 1;
                    setCartItemQuantity(itemId, quantity);
                });
            });
            
            // Remove buttons
            document.querySelectorAll('.item-remove').forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    removeCartItem(itemId);
                });
            });
        }

        // Update cart item quantity
        function updateCartItemQuantity(itemId, change) {
            const cart = getCart();
            const item = cart.find(item => item.id === itemId);
            
            if (item) {
                const newQuantity = item.quantity + change;
                if (newQuantity >= 1) {
                    item.quantity = newQuantity;
                    saveCart(cart);
                    loadCartItems();
                    
                    if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                        window.MakananWongSolo.showNotification(`Jumlah ${item.name} diperbarui`, 'success');
                    }
                }
            }
        }

        // Set cart item quantity
        function setCartItemQuantity(itemId, quantity) {
            const cart = getCart();
            const item = cart.find(item => item.id === itemId);
            
            if (item && quantity >= 1) {
                item.quantity = quantity;
                saveCart(cart);
                loadCartItems();
                
                if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                    window.MakananWongSolo.showNotification(`Jumlah ${item.name} diperbarui`, 'success');
                }
            }
        }

        // Remove cart item
        function removeCartItem(itemId) {
            const cart = getCart();
            const item = cart.find(item => item.id === itemId);
            
            if (item) {
                const newCart = cart.filter(item => item.id !== itemId);
                saveCart(newCart);
                loadCartItems();
                
                if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                    window.MakananWongSolo.showNotification(`${item.name} dihapus dari keranjang`, 'success');
                }
            }
        }

        // Update cart summary
        function updateCartSummary(subtotal) {
            const deliveryFee = 10000;
            const total = subtotal + deliveryFee;
            
            // Update DOM
            const subtotalElement = document.getElementById('subtotal');
            const totalElement = document.getElementById('totalAmount');
            
            if (subtotalElement) {
                subtotalElement.textContent = `Rp ${subtotal.toLocaleString('id-ID')}`;
            }
            
            if (totalElement) {
                totalElement.textContent = `Rp ${total.toLocaleString('id-ID')}`;
            }
            
            // Update order data
            orderData.items = getCart();
            orderData.total = total;
        }

        // Load orders history
        function loadOrdersHistory() {
            const orders = getOrders();
            const ordersList = document.getElementById('ordersList');
            const emptyOrdersState = document.getElementById('emptyOrdersState');
            const ordersTabCount = document.getElementById('ordersTabCount');
            
            if (orders.length === 0) {
                if (emptyOrdersState) emptyOrdersState.style.display = 'flex';
                if (ordersList) ordersList.style.display = 'none';
                if (ordersTabCount) ordersTabCount.textContent = '0';
                return;
            }
            
            if (emptyOrdersState) emptyOrdersState.style.display = 'none';
            if (ordersList) ordersList.style.display = 'block';
            if (ordersTabCount) ordersTabCount.textContent = orders.length.toString();
            
            // Render orders
            if (ordersList) {
                ordersList.innerHTML = orders.map(order => {
                    const orderDate = new Date(order.date);
                    const formattedDate = orderDate.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const itemsList = order.items.map(item => 
                        `${item.name} (${item.quantity}x)`
                    ).join(', ');
                    
                    return `
                        <div class="order-card">
                            <div class="order-header">
                                <div class="order-id">
                                    <i class="fas fa-receipt"></i>
                                    ${order.orderId}
                                </div>
                                <div class="order-status status-${order.status}">
                                    ${getStatusText(order.status)}
                                </div>
                            </div>
                            <div class="order-body">
                                <div class="order-details">
                                    <div class="detail-row">
                                        <span class="detail-label">Tanggal:</span>
                                        <span class="detail-value">${formattedDate}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Nama:</span>
                                        <span class="detail-value">${order.customer.name}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">WhatsApp:</span>
                                        <span class="detail-value">${order.customer.phone}</span>
                                    </div>
                                    <div class="detail-row">
                                        <span class="detail-label">Items:</span>
                                        <span class="detail-value">${itemsList}</span>
                                    </div>
                                    ${order.customer.notes ? `
                                    <div class="detail-row">
                                        <span class="detail-label">Catatan:</span>
                                        <span class="detail-value">${order.customer.notes}</span>
                                    </div>
                                    ` : ''}
                                </div>
                                <div class="order-total">
                                    <span>Total:</span>
                                    <strong>Rp ${order.total.toLocaleString('id-ID')}</strong>
                                </div>
                            </div>
                            <div class="order-actions">
                                <button class="btn btn-sm btn-outline" onclick="repeatOrder('${order.orderId}')">
                                    <i class="fas fa-redo"></i>
                                    Pesan Ulang
                                </button>
                                <a href="https://api.whatsapp.com/send/?phone=6289513439235&text=${encodeURIComponent(`Halo, saya ingin konfirmasi pesanan ${order.orderId}`)}" 
                                   target="_blank" class="btn btn-sm btn-primary">
                                    <i class="fab fa-whatsapp"></i>
                                    Hubungi WhatsApp
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        // Setup checkout modal
        function setupCheckoutModal() {
            const checkoutBtn = document.getElementById('checkoutBtn');
            const checkoutModal = document.getElementById('checkoutModal');
            const checkoutOverlay = document.getElementById('checkoutOverlay');
            const checkoutClose = document.getElementById('checkoutClose');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const prevStepBtn = document.getElementById('prevStepBtn');
            const confirmWhatsAppBtn = document.getElementById('confirmWhatsAppBtn');
            
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    if (getCart().length === 0) {
                        if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                            window.MakananWongSolo.showNotification('Keranjang masih kosong', 'warning');
                        }
                        return;
                    }
                    
                    openCheckoutModal();
                });
            }
            
            if (checkoutOverlay) {
                checkoutOverlay.addEventListener('click', closeCheckoutModal);
            }
            
            if (checkoutClose) {
                checkoutClose.addEventListener('click', closeCheckoutModal);
            }
            
            if (nextStepBtn) {
                nextStepBtn.addEventListener('click', nextStep);
            }
            
            if (prevStepBtn) {
                prevStepBtn.addEventListener('click', prevStep);
            }
            
            // Close modal with Escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && checkoutModal.classList.contains('active')) {
                    closeCheckoutModal();
                }
            });
        }

        // Open checkout modal
        function openCheckoutModal() {
            const checkoutModal = document.getElementById('checkoutModal');
            const checkoutItems = document.getElementById('checkoutItems');
            const checkoutTotal = document.getElementById('checkoutTotal');
            
            if (!checkoutModal || !checkoutItems) return;
            
            // Load cart items into checkout preview
            const cart = getCart();
            let subtotal = 0;
            
            checkoutItems.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                return `
                    <div class="checkout-item">
                        <span>${item.name} × ${item.quantity}</span>
                        <span>Rp ${itemTotal.toLocaleString('id-ID')}</span>
                    </div>
                `;
            }).join('');
            
            const total = subtotal + 10000; // delivery fee
            
            if (checkoutTotal) {
                checkoutTotal.textContent = `Rp ${total.toLocaleString('id-ID')}`;
            }
            
            // Reset form
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('orderNotes').value = '';
            
            // Reset steps
            currentStep = 1;
            updateCheckoutSteps();
            
            // Show modal
            checkoutModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close checkout modal
        function closeCheckoutModal() {
            const checkoutModal = document.getElementById('checkoutModal');
            if (checkoutModal) {
                checkoutModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // Next step in checkout
        function nextStep() {
            if (currentStep === 1) {
                // Validate step 1
                const name = document.getElementById('customerName').value.trim();
                const phone = document.getElementById('customerPhone').value.trim();
                
                if (!name || !phone) {
                    if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                        window.MakananWongSolo.showNotification('Harap isi nama dan nomor WhatsApp', 'error');
                    }
                    return;
                }
                
                // Save customer data
                orderData.customer = {
                    name: name,
                    phone: phone,
                    address: document.getElementById('customerAddress').value.trim(),
                    notes: document.getElementById('orderNotes').value.trim()
                };
                
                // Generate order ID
                orderData.orderId = generateOrderId();
                orderData.date = new Date().toISOString();
                
                // Update confirmation details
                updateConfirmationDetails();
            }
            
            currentStep++;
            updateCheckoutSteps();
        }

        // Previous step in checkout
        function prevStep() {
            currentStep--;
            updateCheckoutSteps();
        }

        // Update checkout steps UI
        function updateCheckoutSteps() {
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const nextStepBtn = document.getElementById('nextStepBtn');
            const prevStepBtn = document.getElementById('prevStepBtn');
            const confirmWhatsAppBtn = document.getElementById('confirmWhatsAppBtn');
            
            // Update step indicators
            document.querySelectorAll('.checkout-steps .step').forEach(step => {
                const stepNum = parseInt(step.dataset.step);
                step.classList.toggle('active', stepNum === currentStep);
                step.classList.toggle('completed', stepNum < currentStep);
            });
            
            // Show/hide step content
            if (step1) step1.classList.toggle('active', currentStep === 1);
            if (step2) step2.classList.toggle('active', currentStep === 2);
            
            // Update buttons
            if (currentStep === 1) {
                if (nextStepBtn) {
                    nextStepBtn.style.display = 'flex';
                    nextStepBtn.innerHTML = 'Selanjutnya <i class="fas fa-arrow-right"></i>';
                }
                if (prevStepBtn) prevStepBtn.style.display = 'none';
                if (confirmWhatsAppBtn) confirmWhatsAppBtn.style.display = 'none';
            } else if (currentStep === 2) {
                if (nextStepBtn) nextStepBtn.style.display = 'none';
                if (prevStepBtn) prevStepBtn.style.display = 'flex';
                if (confirmWhatsAppBtn) {
                    confirmWhatsAppBtn.style.display = 'flex';
                    
                    // Update WhatsApp link
                    const whatsappText = generateWhatsAppMessage();
                    confirmWhatsAppBtn.href = `https://api.whatsapp.com/send/?phone=6289513439235&text=${encodeURIComponent(whatsappText)}&type=phone_number&app_absent=0`;
                }
            }
        }

        // Update confirmation details
        function updateConfirmationDetails() {
            document.getElementById('confirmationOrderId').textContent = orderData.orderId;
            document.getElementById('confirmationName').textContent = orderData.customer.name;
            document.getElementById('confirmationPhone').textContent = orderData.customer.phone;
            document.getElementById('confirmationTotal').textContent = `Rp ${orderData.total.toLocaleString('id-ID')}`;
        }

        // Generate order ID
        function generateOrderId() {
            const timestamp = new Date().getTime();
            const random = Math.floor(Math.random() * 1000);
            return `#ORD-${timestamp.toString().slice(-6)}${random.toString().padStart(3, '0')}`;
        }

        // Generate WhatsApp message
        function generateWhatsAppMessage() {
            const cart = getCart();
            const itemsText = cart.map(item => 
                `• ${item.name} - ${item.quantity} × Rp ${item.price.toLocaleString('id-ID')} = Rp ${(item.price * item.quantity).toLocaleString('id-ID')}`
            ).join('\n');
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = subtotal + 10000;
            
            let message = `Halo Makanan Wong Solo,\n\n`;
            message += `Saya ingin memesan makanan dengan detail berikut:\n\n`;
            message += `*Nomor Pesanan:* ${orderData.orderId}\n`;
            message += `*Nama:* ${orderData.customer.name}\n`;
            message += `*WhatsApp:* ${orderData.customer.phone}\n\n`;
            
            if (orderData.customer.address) {
                message += `*Alamat:* ${orderData.customer.address}\n\n`;
            }
            
            message += `*Daftar Pesanan:*\n${itemsText}\n\n`;
            message += `*Subtotal:* Rp ${subtotal.toLocaleString('id-ID')}\n`;
            message += `*Biaya Pengiriman:* Rp 10.000\n`;
            message += `*Total:* Rp ${total.toLocaleString('id-ID')}\n\n`;
            
            if (orderData.customer.notes) {
                message += `*Catatan:* ${orderData.customer.notes}\n\n`;
            }
            
            message += `Mohon konfirmasi ketersediaan dan total pembayaran. Terima kasih!`;
            
            return message;
        }

        // Repeat order function
        function repeatOrder(orderId) {
            const orders = getOrders();
            const order = orders.find(o => o.orderId === orderId);
            
            if (order) {
                // Clear current cart
                saveCart([]);
                
                // Add order items to cart
                order.items.forEach(item => {
                    addToCart(item.id, item.name, item.price, item.quantity);
                });
                
                // Show success message
                if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                    window.MakananWongSolo.showNotification('Pesanan berhasil ditambahkan ke keranjang', 'success');
                }
                
                // Reload cart
                loadCartItems();
                
                // Switch to cart tab
                document.querySelector('.order-tab[data-tab="keranjang"]').click();
            }
        }

        // Helper functions
        function getCart() {
            try {
                return JSON.parse(localStorage.getItem('makananWongSoloCart')) || [];
            } catch (error) {
                console.error('Error getting cart:', error);
                return [];
            }
        }

        function saveCart(cart) {
            try {
                localStorage.setItem('makananWongSoloCart', JSON.stringify(cart));
                updateCartCounter();
                return true;
            } catch (error) {
                console.error('Error saving cart:', error);
                return false;
            }
        }

        function getOrders() {
            try {
                return JSON.parse(localStorage.getItem('makananWongSoloOrders')) || [];
            } catch (error) {
                console.error('Error getting orders:', error);
                return [];
            }
        }

        function saveOrders(orders) {
            try {
                localStorage.setItem('makananWongSoloOrders', JSON.stringify(orders));
                return true;
            } catch (error) {
                console.error('Error saving orders:', error);
                return false;
            }
        }

        function addToCart(productId, productName, price, quantity = 1) {
            const cart = getCart();
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: price,
                    quantity: quantity,
                    addedAt: new Date().toISOString()
                });
            }
            
            saveCart(cart);
        }

        function updateCartCounter() {
            const cartCounter = document.getElementById('cartCounter');
            if (cartCounter) {
                try {
                    const cart = getCart();
                    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                    const countElement = cartCounter.querySelector('.cart-count');
                    if (countElement) {
                        countElement.textContent = totalItems;
                        countElement.style.display = totalItems > 0 ? 'flex' : 'none';
                    }
                } catch (error) {
                    console.error('Error updating cart counter:', error);
                }
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Menunggu Konfirmasi';
                case 'processing': return 'Diproses';
                case 'completed': return 'Selesai';
                case 'cancelled': return 'Dibatalkan';
                default: return 'Menunggu';
            }
        }

        // Listen for checkout completion
        document.addEventListener('checkoutCompleted', function(event) {
            // Save order to history
            const orders = getOrders();
            orders.unshift({
                ...orderData,
                status: 'pending'
            });
            saveOrders(orders);
            
            // Clear cart
            saveCart([]);
            
            // Reload everything
            loadCartItems();
            loadOrdersHistory();
            
            // Close modal
            closeCheckoutModal();
            
            // Show success message
            if (window.MakananWongSolo && window.MakananWongSolo.showNotification) {
                window.MakananWongSolo.showNotification('Pesanan berhasil dibuat! Silakan konfirmasi via WhatsApp', 'success');
            }
            
            // Switch to orders tab
            document.querySelector('.order-tab[data-tab="pesanan-saya"]').click();
        });
    </script>
</body>
</html>
